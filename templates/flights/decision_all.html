{% extends 'base.html' %}

{% block title %}여행 정보{% endblock %}

{% block content %}
<!-- Header -->
<div class="header text-center py-3 position-relative" style="background-color: #f0f0f0;">
    <!-- 이전 페이지 버튼을 왼쪽에 고정 -->
    <a href="/flights" class="btn btn-secondary position-absolute"
       style="left: 3%; top: 50%; transform: translateY(-50%);">메인 페이지</a>
    <!-- 중앙 정렬된 제목과 설명 -->
    <div class="d-flex flex-column align-items-center justify-content-center">
        <a href="/flights" class="text-decoration-none">
            <h1 class="fw-bold text-primary">Life Is Travel</h1>
        </a>
        <p class="text-center text-muted">
            여행은 가고 싶은데, 어떻게 할 지 모르겠어. 도와줘!
        </p>
    </div>
</div>

<!-- 검색 조건 요약 영역 -->
<div class="container my-4">
    <h2 class="mb-4">여행 정보</h2>
    <div class="row g-3">
        <!-- 예산 -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-info">
                <div class="card-body">
                    <h5 class="card-title">예산</h5>
                    <p class="card-text">
                        {{ budget }} 원
                    </p>
                </div>
            </div>
        </div>
        <!-- 출발일 (범위) -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-primary">
                <div class="card-body">
                    <h5 class="card-title">출발일(범위)</h5>
                    <p class="card-text">
                        {% if departure_start and departure_end %}
                            {{ departure_start }} ~ {{ departure_end }}
                        {% else %}
                            -
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        <!-- 도착일 (범위) -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-warning">
                <div class="card-body">
                    <h5 class="card-title">도착일(범위)</h5>
                    <p class="card-text">
                        {% if arrival_start and arrival_end %}
                            {{ arrival_start }} ~ {{ arrival_end }}
                        {% else %}
                            -
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        <!-- 여행지(도시들) -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-success">
                <div class="card-body">
                    <h5 class="card-title">여행지</h5>
                    <p class="card-text">
                        {% if cities %}
                            {{ cities|join:", " }}
                        {% else %}
                            미정
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 비행기+호텔 조합 리스트 -->
<div class="container mb-5">
    <h2 class="mb-3">추천 조합</h2>

    {% if results and results|length > 0 %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for item in results %}
                <!-- item: {'flight': flight_obj, 'hotel': hotel_obj, 'total_cost': ...} -->
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            총 비용: {{ item.total_cost|floatformat:0 }} 원
                        </div>
                        <div class="card-body">
                            <!-- 비행기 정보 -->
                            <h5 class="card-title text-primary mb-2">
                                ✈ 항공 : {{ item.flight.airline }}
                                ({{ item.flight.departure }} → {{ item.flight.destination }})
                            </h5>
                            <ul class="list-group list-group-flush mb-3">
                                <li class="list-group-item">
                                    <strong>출발일:</strong>
                                    {{ item.flight.departure_date }} {{ item.flight.departure_time|default_if_none:"" }}
                                </li>
                                <li class="list-group-item">
                                    <strong>리턴일:</strong>
                                    {{ item.flight.return_date }} {{ item.flight.return_time|default_if_none:"" }}
                                </li>
                                <li class="list-group-item">
                                    <strong>항공권 가격:</strong> {{ item.flight.price|floatformat:0 }} 원
                                </li>
                                {% if item.flight.url %}
                                    <li class="list-group-item">
                                        <strong>예매 링크:</strong>
                                        <a href="{{ item.flight.url }}" target="_blank">
                                            바로 가기
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>

                            <!-- 호텔 정보 -->
                            <h5 class="card-title text-success mb-2">
                                \u{1F3E8} 호텔 : {{ item.hotel.hotel_name }}
                                ({{ item.hotel.city }})
                            </h5>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <strong>체크인:</strong> {{ item.hotel.check_in }}
                                </li>
                                <li class="list-group-item">
                                    <strong>체크아웃:</strong> {{ item.hotel.check_out }}
                                </li>
                                <li class="list-group-item">
                                    <strong>숙박 가격:</strong> {{ item.hotel.price|floatformat:0 }} 원
                                </li>
                                {% if item.hotel.url %}
                                    <li class="list-group-item">
                                        <strong>예약 링크:</strong>
                                        <a href="{{ item.hotel.url }}" target="_blank">
                                            바로 가기
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">현재 조건에 맞는 조합이 없습니다.</p>
    {% endif %}
</div>
{% endblock %}
